# Passkey Blockchain Wallet

**PasskeyæŠ€è¡“ã¨Safeã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚’æ´»ç”¨ã—ãŸæ¬¡ä¸–ä»£Web3ã‚¦ã‚©ãƒ¬ãƒƒãƒˆ**

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã®ç”Ÿä½“èªè¨¼ï¼ˆPasskeyï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’ç®¡ç†ã™ã‚‹é©æ–°çš„ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ç§˜å¯†éµã®ä¿ç®¡ãŒä¸è¦ã§ã€Googleèªè¨¼ã«ã‚ˆã‚‹ç°¡å˜ãªã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

## ä¸»è¦æ©Ÿèƒ½

- ğŸ” **Passkeyèªè¨¼**: ãƒ‡ãƒã‚¤ã‚¹ã®ç”Ÿä½“èªè¨¼ã‚’ä½¿ç”¨ã—ãŸå®‰å…¨ãªèªè¨¼
- ğŸ¦ **Safeçµ±åˆ**: Gnosis Safeï¼ˆç¾Safeï¼‰ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¦ã‚©ãƒ¬ãƒƒãƒˆ
- â›½ **ã‚¬ã‚¹ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**: Pimlico Paymasterã«ã‚ˆã‚‹ã‚¹ãƒãƒ³ã‚µãƒ¼ä»˜ããƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³
- ğŸŒ **Web2 Auth**: Google OAuth ã«ã‚ˆã‚‹ç°¡å˜ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
- âœ… **ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³è¨¼æ˜**: EIP-712ç½²åã«ã‚ˆã‚‹ã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ­£å½“æ€§è¨¼æ˜
- ğŸ’¾ **ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: LocalStorageã¨Firebaseã«ã‚ˆã‚‹ã‚¯ãƒ­ã‚¹ãƒ‡ãƒã‚¤ã‚¹åŒæœŸ

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Next.js 15.5.4** (App Router + Turbopack)
- **React 19.1.0**
- **TypeScript 5**
- **Material-UI** + **Tailwind CSS 4.0**

### Web3
- **Safe Protocol Kit v4.1.0** - Safe ã‚¦ã‚©ãƒ¬ãƒƒãƒˆç®¡ç†
- **Safe Relay Kit v3.1.0** - ERC-4337 Account Abstraction
- **Viem v2.37.9** - Ethereum ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- **Pimlico** - Bundler & Paymaster ã‚µãƒ¼ãƒ“ã‚¹

### èªè¨¼ & ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **NextAuth.js** - OAuth èªè¨¼
- **Firebase Authentication** - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **Firebase Firestore** - ã‚¯ãƒ©ã‚¦ãƒ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
- **LocalStorage** - ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯**ãƒ¢ã‚¸ãƒ¥ãƒ©ãƒ¼ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã‚’æ¡ç”¨ã—ã¦ãŠã‚Šã€èªè¨¼ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ»ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ã„ã¾ã™ã€‚

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
src/
â”œâ”€â”€ modules/                      # ç‹¬ç«‹ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç¾¤
â”‚   â”œâ”€â”€ auth/                     # èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ client/               # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´èªè¨¼
â”‚   â”‚   â”‚   â”œâ”€â”€ useAuth.tsx       # çµ±ä¸€èªè¨¼ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”‚   â””â”€â”€ firebase-auth.ts  # Firebase Authæ“ä½œ
â”‚   â”‚   â”œâ”€â”€ server/               # ã‚µãƒ¼ãƒãƒ¼å´èªè¨¼
â”‚   â”‚   â”‚   â”œâ”€â”€ auth-service.ts   # èªè¨¼ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”‚   â””â”€â”€ firebase-admin-auth.ts
â”‚   â”‚   â”œâ”€â”€ types.ts              # èªè¨¼å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â””â”€â”€ database/                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚       â”œâ”€â”€ client/               # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´DB
â”‚       â”‚   â”œâ”€â”€ repositories/     # ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚       â”‚   â”‚   â”œâ”€â”€ WalletRepository.ts
â”‚       â”‚   â”‚   â””â”€â”€ LocalStorageRepository.ts
â”‚       â”‚   â”œâ”€â”€ hooks/
â”‚       â”‚   â”‚   â””â”€â”€ useWalletStorage.tsx
â”‚       â”‚   â””â”€â”€ firebase-client.ts
â”‚       â”œâ”€â”€ server/               # ã‚µãƒ¼ãƒãƒ¼å´DB
â”‚       â”‚   â”œâ”€â”€ repositories/
â”‚       â”‚   â”‚   â””â”€â”€ UserRepository.ts
â”‚       â”‚   â””â”€â”€ firebase-admin-db.ts
â”‚       â”œâ”€â”€ types.ts              # DBå‹å®šç¾©
â”‚       â””â”€â”€ index.ts
â”‚
â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”œâ”€â”€ auth/[...nextauth]/   # NextAuth.js
â”‚   â”‚   â””â”€â”€ attest/               # è¨¼æ˜API
â”‚   â”‚       â”œâ”€â”€ sign/             # ADMINç½²åç”Ÿæˆ
â”‚   â”‚       â””â”€â”€ submit/           # è¨¼æ˜é€ä¿¡
â”‚   â”œâ”€â”€ components/               # Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ hooks/                    # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ safepasskeyFooks.tsx  # Wallet/Passkeyç®¡ç†
â”‚   â”œâ”€â”€ libs/                     # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ legitRegistry.ts      # EIP-712è¨¼æ˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ executeTx.ts          # ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
â”‚   â”‚   â””â”€â”€ submitAttestation.ts
â”‚   â””â”€â”€ page.tsx                  # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚
â””â”€â”€ contract/                     # Solidityã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ
    â””â”€â”€ src/
        â””â”€â”€ LegitRegistry712.sol  # è¨¼æ˜ãƒ¬ã‚¸ã‚¹ãƒˆãƒª
```

---

## ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°

### 1. èªè¨¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (`modules/auth/`)

**ç›®çš„**: NextAuth.jsã¨Firebase Authenticationã‚’çµ±åˆã—ã€ä¸€è²«ã—ãŸèªè¨¼APIã‚’æä¾›

#### `useAuth()` ãƒ•ãƒƒã‚¯ - çµ±ä¸€èªè¨¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
import { useAuth } from '@/modules/auth/client/useAuth'

function MyComponent() {
  const { user, isAuthenticated, isLoading, logout } = useAuth()

  // user.id - ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (NextAuth + Firebaseçµ±åˆ)
  // user.email - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  // user.firebaseUser - Firebase Userã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
}
```

**èªè¨¼ãƒ•ãƒ­ãƒ¼:**

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ â†’ Google OAuth (NextAuth)
2. NextAuth â†’ JWT Sessionç”Ÿæˆ
3. authService.generateFirebaseToken() â†’ Firebaseã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒ¼ã‚¯ãƒ³
4. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ signInWithFirebase() â†’ Firebaseèªè¨¼å®Œäº†
5. Firestoreã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (`modules/database/`)

**ç›®çš„**: ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã‚’æŠ½è±¡åŒ–ã—ã€ãƒªãƒã‚¸ãƒˆãƒªãƒ‘ã‚¿ãƒ¼ãƒ³ã§ç®¡ç†

#### `useWalletStorage()` - ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ•ãƒƒã‚¯

```typescript
import { useWalletStorage } from '@/modules/database/client/hooks/useWalletStorage'

function MyComponent() {
  const storage = useWalletStorage(googleUserId)

  // ä¿å­˜ï¼ˆLocalStorage + FirebaseåŒæ™‚ï¼‰
  await storage.saveWallet(walletData)

  // èª­ã¿è¾¼ã¿ï¼ˆLocalStorageå„ªå…ˆã€Firebase fallbackï¼‰
  const wallets = await storage.loadWallets()

  // ãƒ‡ãƒ—ãƒ­ã‚¤æ›´æ–°ï¼ˆä¸¡æ–¹ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
  await storage.updateDeployment(address, txHash)
}
```

**ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æˆ¦ç•¥:**

```
ä¿å­˜æ™‚:
  1. LocalStorageã«å³åº§ã«ä¿å­˜ï¼ˆé«˜é€Ÿã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼‰
  2. Firestoreã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰åŒæœŸï¼‰

èª­ã¿è¾¼ã¿æ™‚:
  1. LocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿
  2. ç©ºã®å ´åˆ â†’ Firestoreã‹ã‚‰å–å¾—
  3. Firestoreãƒ‡ãƒ¼ã‚¿ â†’ LocalStorageã«åŒæœŸ
```

---

## ã‚¦ã‚©ãƒ¬ãƒƒãƒˆç®¡ç†ãƒ•ãƒ­ãƒ¼

### 1. ã‚¦ã‚©ãƒ¬ãƒƒãƒˆä½œæˆãƒ•ãƒ­ãƒ¼

```typescript
// 1. Passkeyä½œæˆï¼ˆWebAuthnï¼‰
const passkey = await createPasskey()

// 2. Safe4337PackåˆæœŸåŒ–
const pack = await Safe4337Pack.init({
  provider: RPC_URL,
  signer: passkey,          // Passkeyã‚’ç½²åè€…ã¨ã—ã¦ä½¿ç”¨
  bundlerUrl: BUNDLER_URL,
  paymasterOptions: {
    isSponsored: true,      // ã‚¬ã‚¹ä»£ã‚¹ãƒãƒ³ã‚µãƒ¼
    paymasterUrl: PAYMASTER_URL
  }
})

// 3. Safeã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—
const address = await pack.protocolKit.getAddress()

// 4. ãƒ‡ãƒ¥ã‚¢ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
await storage.saveWallet({
  safeAddress: address,
  passkey,
  googleUserID,
  createdAt: new Date().toISOString(),
  isDeployed: false
})
```

### 2. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

```typescript
// 1. SafeOperationã‚’ä½œæˆ
const safeOperation = await safe4337Pack.createTransaction({
  transactions: [{ to, value, data }]
})

// 2. Passkeyã§ç½²å
const signedOperation = await safe4337Pack.signSafeOperation(safeOperation)

// 3. BundlerçµŒç”±ã§å®Ÿè¡Œï¼ˆã‚¬ã‚¹ãƒ¬ã‚¹ï¼‰
const userOpHash = await safe4337Pack.executeTransaction({
  executable: signedOperation
})

// 4. ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
if (!isDeployed) {
  await storage.updateDeployment(safeAddress, userOpHash)
}
```

---

## è¨¼æ˜ã‚·ã‚¹ãƒ†ãƒ  (Attestation)

### æ¦‚è¦

EIP-712ç½²åã‚’ä½¿ç”¨ã—ãŸã‚¦ã‚©ãƒ¬ãƒƒãƒˆæ­£å½“æ€§è¨¼æ˜ã‚·ã‚¹ãƒ†ãƒ ã€‚ADMINã®ç½²åã«ã‚ˆã‚Šã€ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒæ­£è¦ã®ã‚‚ã®ã§ã‚ã‚‹ã“ã¨ã‚’ã‚ªãƒ³ãƒã‚§ãƒ¼ãƒ³ã§è¨¼æ˜ã—ã¾ã™ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ              ã‚µãƒ¼ãƒãƒ¼                ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³
    â”‚                      â”‚                          â”‚
    â”‚  POST /api/attest/submit                       â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                          â”‚
    â”‚                      â”‚                          â”‚
    â”‚                      â”‚  Claimä½œæˆ + ADMINç½²å    â”‚
    â”‚                      â”‚                          â”‚
    â”‚                      â”‚  submitAttestation()     â”‚
    â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                      â”‚                          â”‚
    â”‚  å®Œäº†é€šçŸ¥ï¼ˆtxHashï¼‰    â”‚                          â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
```

### ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒ

```typescript
// Firestore 'wallets' ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)
interface WalletData {
  safeAddress: string
  passkey: PasskeyArgType
  googleUserID: string | null
  createdAt: string
  isDeployed: boolean
  passkeyData: {
    rawId: string
    coordinates: { x: string, y: string }
  }
  deployedAt?: string
  deploymentTxHash?: string
}

// Firestore 'users' ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (ã‚µãƒ¼ãƒãƒ¼)
interface UserData {
  userId: string
  email: string | null
  name: string | null
  walletAddress: string
  passkeyPublicKey: string
  passkeyCredentialId: string
  createdAt: string
  attested: boolean
  attestationTxHash?: string
  attestedAt?: string
}
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### èªè¨¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **å¤šå±¤èªè¨¼**: Google OAuth â†’ NextAuth â†’ Firebase
- **ãƒˆãƒ¼ã‚¯ãƒ³æœ‰åŠ¹æœŸé™**: JWTãƒˆãƒ¼ã‚¯ãƒ³ã®è‡ªå‹•æ›´æ–°
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†**: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼

### ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **Passkeyä¿è­·**: ãƒ‡ãƒã‚¤ã‚¹ã®Secure Enclaveã«ä¿å­˜
- **ç½²ååˆ†é›¢**: ç§˜å¯†éµã¯ãƒ‡ãƒã‚¤ã‚¹å†…ã§ç”Ÿæˆãƒ»ä¿å­˜ã€å¤–éƒ¨ã«å‡ºãªã„
- **Safeå¥‘ç´„**: ãƒãƒ«ãƒã‚·ã‚°å¯¾å¿œã®ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¦ã‚©ãƒ¬ãƒƒãƒˆ

### ãƒ‡ãƒ¼ã‚¿ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- **æš—å·åŒ–é€šä¿¡**: HTTPS/WSS
- **Firebase Security Rules**: ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ™ãƒ¼ã‚¹ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒƒã‚·ãƒ¥ï¼ˆPepperä»˜ãkeccak256ï¼‰

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### 1. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

#### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```bash
# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret

# NextAuth
NEXTAUTH_SECRET=your_nextauth_secret
NEXTAUTH_URL=http://localhost:3000

# Firebase Client
NEXT_PUBLIC_FIREBASE_API_KEY=your_firebase_api_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_project.firebaseapp.com
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project_id
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_project.appspot.com
NEXT_PUBLIC_FIREBASE_APP_ID=your_firebase_app_id

# Firebase Admin
FIREBASE_ADMIN_PROJECT_ID=your_project_id
FIREBASE_ADMIN_CLIENT_EMAIL=firebase-adminsdk@your_project.iam.gserviceaccount.com
FIREBASE_ADMIN_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"

# Pimlico
NEXT_PUBLIC_PIMLICO_API_KEY=your_pimlico_api_key

# ã‚¹ãƒãƒ¼ãƒˆã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ
NEXT_PUBLIC_LEGIT_REGISTRY_ADDRESS=0x...
ADMIN_PRIVATE_KEY=0x...
USER_HASH_PEPPER=your_secure_pepper
```

#### 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

http://localhost:3000 ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹

#### 4. ãƒ“ãƒ«ãƒ‰

```bash
npm run build
npm start
```

### ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤

```bash
cd contract

# ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒ¼ãƒ‰èµ·å‹•
anvil

# ãƒ‡ãƒ—ãƒ­ã‚¤
forge script script/DeployLocal.s.sol --rpc-url http://localhost:8545 --broadcast

# Sepoliaãƒ‡ãƒ—ãƒ­ã‚¤
forge script script/DeployLocal.s.sol --rpc-url $SEPOLIA_RPC_URL --broadcast --verify
```

---

## æ‹¡å¼µæ€§

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯ä»¥ä¸‹ã®æ‹¡å¼µãŒå®¹æ˜“ã§ã™:

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ‡ã‚Šæ›¿ãˆ

```typescript
// modules/database/client/repositories/SupabaseRepository.ts
export class SupabaseRepository implements WalletStorageInterface {
  async save(wallet: WalletData): Promise<void> {
    // Supabaseå®Ÿè£…
  }
}
```

### èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¿½åŠ 

```typescript
// NextAuthè¨­å®šã«è¿½åŠ 
providers: [
  GoogleProvider({ ... }),
  MetaMaskProvider({ ... })  // æ–°è¦è¿½åŠ 
]
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ã®è¿½åŠ 

```typescript
export class CachedWalletRepository extends WalletRepository {
  private cache = new Map<string, WalletData>()

  async findByAddress(address: string): Promise<WalletData | null> {
    if (this.cache.has(address)) {
      return this.cache.get(address)!
    }

    const wallet = await super.findByAddress(address)
    if (wallet) this.cache.set(address, wallet)
    return wallet
  }
}
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### PasskeyãŒä½œæˆã§ããªã„

**åŸå› **: HTTPSã¾ãŸã¯localhostã§ãªã„ç’°å¢ƒ
**è§£æ±º**: HTTPSç’°å¢ƒã§å®Ÿè¡Œã™ã‚‹ã‹ã€`localhost`ã‚’ä½¿ç”¨

### Firebaseèªè¨¼ã‚¨ãƒ©ãƒ¼

**åŸå› **: ç’°å¢ƒå¤‰æ•°ã®è¨­å®šãƒŸã‚¹
**è§£æ±º**: `.env.local`ã‚’ç¢ºèªã—ã€ã™ã¹ã¦ã®`FIREBASE_*`å¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

### ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã™ã‚‹

**åŸå› **: Paymasterã®æ®‹é«˜ä¸è¶³ã€ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼
**è§£æ±º**:
1. Pimlicoãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§æ®‹é«˜ç¢ºèª
2. RPC URLã®æ¥ç¶šç¢ºèª
3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆSepoliaï¼‰ãŒæ­£ã—ã„ã‹ç¢ºèª

### ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãŒå¾©å…ƒã§ããªã„

**åŸå› **: LocalStorageã¾ãŸã¯Firebaseã®ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ
**è§£æ±º**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§LocalStorageã‚’ç¢ºèª
2. Firebase Consoleã§ã‚¦ã‚©ãƒ¬ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
3. `clearWalletData()`ã§åˆæœŸåŒ–ã—ã¦å†ä½œæˆ

---

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## å‚è€ƒãƒªãƒ³ã‚¯

- [Safe Protocol Kit](https://docs.safe.global/sdk/protocol-kit)
- [ERC-4337 Account Abstraction](https://eips.ethereum.org/EIPS/eip-4337)
- [WebAuthn / Passkeys](https://webauthn.guide/)
- [EIP-712 Typed Data](https://eips.ethereum.org/EIPS/eip-712)
- [Pimlico Documentation](https://docs.pimlico.io/)
- [NextAuth.js](https://next-auth.js.org/)
- [Firebase](https://firebase.google.com/docs)
